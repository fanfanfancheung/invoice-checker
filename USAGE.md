# 发票检查器 - 使用说明

## 🎯 功能概览

这个系统帮你自动化处理采购发票验证和上传的工作流程。

### 核心流程

```
1️⃣ 上传合同 
   ↓
2️⃣ 系统识别采购单号、金额等信息
   ↓
3️⃣ 上传对应发票
   ↓
4️⃣ 系统自动验证规格型号和金额
   ↓
5️⃣ ✅ 通过 → 上传到领星 | ❌ 不通过 → 提示错误
```

## 📸 界面说明

### 主界面

```
┌─────────────────────────────────────────────────┐
│  📋 发票检查器                                   │
│  采购发票自动化验证系统                          │
├─────────────────────────────────────────────────┤
│                                                 │
│  [ 📄 上传合同 ]  [ 🧾 上传发票 ]               │
│                                                 │
│  ┌──────────────────────────────────────────┐  │
│  │  📁 将合同拖到这里                        │  │
│  │  或点击选择文件（支持 PDF、图片）         │  │
│  └──────────────────────────────────────────┘  │
│                                                 │
├─────────────────────────────────────────────────┤
│  合同列表                                        │
│                                                 │
│  🟢 PO-2024001  2024-01-15  数量:100  ¥50,000  │
│     ✓ 金额一致  2张发票                  [▼]   │
│                                                 │
│  🟡 PO-2024002  2024-01-16  数量:200  ¥80,000  │
│     欠 ¥30,000  1张发票                  [▼]   │
└─────────────────────────────────────────────────┘
```

### 状态说明

| 颜色 | 含义 | 说明 |
|------|------|------|
| 🟢 绿色 | 金额一致 | 所有发票金额 = 合同总金额 |
| 🟡 黄色 | 金额不一致 | 显示还欠多少钱 |

## 🔄 操作步骤

### 1. 上传合同

1. 点击 **"📄 上传合同"** 按钮
2. 拖拽合同PDF到上传区域，或点击选择文件
3. 系统自动识别:
   - 采购单号 (PO Number)
   - 订单日期
   - 数量
   - 总金额

4. 合同出现在列表中，默认为🟡黄色(未完成)

### 2. 上传发票

1. 点击 **"🧾 上传发票"** 按钮
2. 拖拽发票PDF到上传区域
3. 系统自动:
   - 从发票备注栏读取合同号
   - 识别规格型号、数量、金额
   - 与对应合同核对

4. **验证通过**:
   - ✅ 规格型号匹配
   - ✅ 发票添加到合同下
   - 如金额凑齐 → 🟢 变绿

5. **验证失败**:
   - ❌ 提示"该发票不可用"
   - 不会添加到合同

### 3. 查看详情

1. 点击任意合同行
2. 展开查看该合同的所有发票明细:
   ```
   发票明细
   ┌────────────────────────────────────────┐
   │ 规格: SKU-A001  数量: 50  ¥25,000  ✓ 已验证 │
   │ 规格: SKU-A001  数量: 50  ¥25,000  ✓ 已验证 │
   └────────────────────────────────────────┘
   ```

## 💡 使用技巧

### ✅ 正确的做法

- **先上传合同，再上传发票** - 系统需要先有合同档案
- **发票备注栏写清楚合同号** - 系统靠这个匹配
- **规格型号要一致** - 不一致会被拒绝

### ❌ 常见错误

- 先上传发票 → 找不到合同会失败
- 发票备注栏没写合同号 → 无法匹配
- 规格型号写错 → 验证不通过

## 🔧 高级功能(即将上线)

### OCR识别优化
- 支持多种发票格式
- 手写体识别
- 人工复核低置信度内容

### 领星集成
- 验证通过的发票自动上传
- 失败重试机制
- 上传结果通知

### 飞书机器人
- 直接在飞书发文件给机器人
- 自动处理和反馈
- 异常情况通知

### 数据看板
- 月度统计
- 供应商发票汇总
- 待处理提醒

## ❓ 常见问题

**Q: 上传的文件保存在哪里？**  
A: 本地存储在 `uploads/` 文件夹，数据库记录在 `invoice_checker.db`

**Q: 可以删除已上传的合同/发票吗？**  
A: MVP版本暂不支持，后续会添加

**Q: OCR识别错了怎么办？**  
A: 后续版本会添加人工复核界面，可以手动修正

**Q: 支持哪些文件格式？**  
A: 目前支持PDF和图片(PNG, JPG)

**Q: 可以批量上传吗？**  
A: 目前一次一个，后续会支持批量

## 📞 需要帮助？

遇到问题随时找帆帆或我 💪
